<app-sidebar></app-sidebar>
<div class="container py-4">
     <div class="alert alert-success d-flex align-items-center" role="alert">
        <i class="bi bi-journal-text me-2"></i>
        <div>
            <strong>Trang Đăng Ký Học Phần</strong> - Sinh viên ngành <strong>{{ majorName }}</strong> chỉ có thể đăng ký các học phần phù hợp với ngành học của mình.
        </div>
    </div>
    <div class="card shadow-sm">
        <div class="card-body">
            <div class="alert alert-info mb-4 flex-column" role="alert">
                <i class="bi bi-info-circle-fill me-2"></i>

                <div class="row mt-4">
                    <div class="col-md-4">
                        <div class="alert alert-primary">
                            <strong>Tín chỉ đã tích lũy:</strong> {{ student.accumulatedCredits }}
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="alert alert-warning">
                            <strong>Tín chỉ đã chọn kỳ này:</strong> {{ student.earnedCredits }}                                                        
                        </div>
                        
                    </div>
                    <div class="col-md-4">
                        <div class="alert alert-danger">
                            <strong>Tín chỉ yêu cầu tối thiểu:</strong> {{ minimumCredits }}
                        </div>
                    </div>
                    
                </div>
                Theo dõi học phần bạn đã đăng ký kỳ này <b style="cursor: pointer;" [routerLink]="['/manage-course/'+studentIdCode]"> tại đây</b>
            </div>

            <!-- Filters -->
            <app-dynamic-table-filter [data]="availableCourses" (filtered)="updateFilteredCourses($event)"  [filterConfig]="filterConfig" >
            </app-dynamic-table-filter>
           


            <!-- Table -->
            <form (ngSubmit)="submitRegistration()">
                <div class="table-responsive">
                    <table class="table table-hover table-striped align-middle">
                        <thead class="table-primary ">
                            <tr>
                                <th scope="col" *ngIf="!studentId">#</th>
                                <th scope="col">Mã học phần</th>
                                <th scope="col">Tên học phần</th>
                                <th scope="col">Giảng viên</th>
                                <th scope="col">Số tín chỉ</th>
                                <th scope="col">Thời gian</th>
                                <th scope="col" *ngIf="studentId">Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let course of displayedCourses"
                                [class.table-secondary]="!isEligible(course)">
                                <td *ngIf="!studentId">
                                    <input type="checkbox" [disabled]="!isEligible(course)"
                                        [value]="course.courseClassId" [checked]="isSelected(course)"
                                        (change)="toggleSelection(course)">
                                </td>
                                <td>{{ course.courseClassId }}</td>
                                <td>
                                    {{ course.subject?.subjectName }}
                                    <span *ngIf="!isEligible(course)" class="text-danger ms-1"
                                        title="Bạn chưa đủ điểm tín chỉ">
                                        <i class="bi bi-lock-fill"></i>
                                    </span>
                                </td>
                                <td>{{ course.lecturer?.fullName || 'Chưa phân công' }}</td>
                                <td>{{ course.subject?.credit }}</td>
                                <td>
                                    {{ getDayOfWeekNames(course.dayOfWeek).join(', ') }}<br />
                                    {{ course.startDate | date:'dd/MM/yyyy' }} - {{ course.endDate | date:'dd/MM/yyyy'
                                    }}
                                </td>
                                <td *ngIf="studentId">
                                    <button class="btn btn-sm btn-outline-primary me-1"
                                        (click)="goToClassPage(course.courseClassId)">
                                        Xem lịch học
                                    </button>
                                    <button class="btn btn-sm btn-outline-primary"
                                        (click)="goToCalendarPage(course.courseClassId)">
                                        Bảng điểm danh
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <button *ngIf="!studentId" type="submit" class="btn btn-primary mt-3"
                    [disabled]="selectedCourses.length === 0">
                    Đăng ký ({{ selectedCourses.length }})
                </button>
            </form>
        </div>
    </div>
</div>

<div *ngIf="isLoading" class="loading-overlay">
  <div class="spinner"></div>
  <p>Creating account, please wait...</p>
</div>

<div *ngIf="isSuccess" class="success-overlay">
  <div class="checkmark-circle">
    <div class="background"></div>
    <div class="checkmark">&#10003;</div>
  </div>
  <p>User created and email sent successfully!</p>
</div>
