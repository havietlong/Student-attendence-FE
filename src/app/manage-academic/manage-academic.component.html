<app-sidebar></app-sidebar>

<div class="container py-5 ">
  <!-- Page Card Wrapper -->
  <div class="card shadow-lg rounded-4 p-4 ml-5" style="background-color: rgba(255, 255, 255, 0.9);">

    <!-- Table Selector and Add Button -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div class="btn-group">
        <button class="btn btn-outline-primary" (click)="selectEntity('class')">Class</button>
        <button class="btn btn-outline-primary" (click)="selectEntity('departments')">Department</button>
        <button class="btn btn-outline-primary" (click)="selectEntity('majors')">Major</button>
        <button class="btn btn-outline-primary" (click)="selectEntity('subject')">Subject</button>
      </div>
      <button class="btn btn-success" (click)="openModal()">+ Create New</button>
    </div>

    <app-dynamic-table-filter [data]="availableCourses" (filtered)="updateFilteredCourses($event)"
      [filterConfig]="filterConfig">
    </app-dynamic-table-filter>    
    <!-- Manage Table Inside Card -->
    <div class="card shadow rounded-4 p-1" style="background-color: rgba(255, 255, 255, 0.95);">
      <app-manage-table [records]="records" [entityName]="selectedEntity" [displayKeys]="columnConfigs[selectedEntity]"
        (refresh)="loadRecords()">
      </app-manage-table>
    </div>
  </div>
</div>

<!-- Modal Background -->
<div class="modal-backdrop fade show" *ngIf="showModal" (click)="closeModal()"></div>

<!-- Modal Card -->
<div class="modal fade show d-block" *ngIf="showModal" tabindex="-1" style="background: rgba(0,0,0,0.3);">
  <div class="modal-dialog modal-lg">
    <div class="modal-content rounded-4 shadow" style="background-color: rgba(255, 255, 255, 0.95);">
      <div class="modal-header">
        <h5 class="modal-title">Create {{ selectedEntity | titlecase }}</h5>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>
      <div class="modal-body">
        <!-- Tabs Inside Modal -->
        <ul class="nav nav-tabs mb-4 justify-content-center" role="tablist">
          <li class="nav-item" *ngFor="let tab of entityTabs" (click)="selectedTab = tab.value">
            <a class="nav-link" [class.active]="selectedTab === tab.value" role="tab">{{ tab.label }}</a>
          </li>
        </ul>

        <!-- Tab Content -->
        <div [ngSwitch]="selectedTab">
          <app-create-class *ngSwitchCase="'class'" (fieldFocus)="onFieldFocused($event)"></app-create-class>
          <app-create-department *ngSwitchCase="'department'"
            (fieldFocus)="onFieldFocused($event)"></app-create-department>
          <app-create-major *ngSwitchCase="'major'" (fieldFocus)="onFieldFocused($event)"></app-create-major>
          <app-create-subject *ngSwitchCase="'subject'" (fieldFocus)="onFieldFocused($event)"></app-create-subject>
        </div>
      </div>
    </div>
  </div>
</div>