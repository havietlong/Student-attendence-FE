<app-sidebar></app-sidebar>

<div class="container py-4">
    <div class="card shadow-sm">
        <div class="card-body">
            <h3 class="card-title text-primary mb-3">
                Bảng điểm của sinh viên: {{ studentId }}
            </h3>

            <!-- FILTERS -->
            <div class="row mb-3">
                <div class="col-md-4">
                    <label class="form-label">Học kỳ</label>
                    <select [(ngModel)]="selectedSemester" (change)="applyFilter()" class="form-select">
                        <option value="">Tất cả</option>
                        <option *ngFor="let sem of semesters" [value]="sem">Học kỳ {{ sem }}</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Năm học</label>
                    <select [(ngModel)]="selectedAcademicYear" (change)="applyFilter()" class="form-select">
                        <option value="">Tất cả</option>
                        <option *ngFor="let year of academicYears" [value]="year">Năm {{ year }}</option>
                    </select>
                </div>
            </div>


            <div class="accordion" id="accordionScores">
                <div class="accordion-item" *ngFor="let subject of subjectGroups; let i = index">
                    <h2 class="accordion-header" id="heading{{i}}">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            [attr.data-bs-target]="'#collapse' + i" aria-expanded="false"
                            [attr.aria-controls]="'collapse' + i">
                            {{ subject.subjectName }} ({{ subject.subjectCode }}) - {{ subject.credit }} tín chỉ
                        </button>
                    </h2>
                    <div [id]="'collapse' + i" class="accordion-collapse collapse"
                        [attr.aria-labelledby]="'heading' + i" data-bs-parent="#accordionScores">
                        <div class="accordion-body">
                            <table class="table table-striped table-hover align-middle">
                                <thead>
                                    <tr>
                                        <th scope="col">Loại điểm</th>
                                        <th scope="col">Ngày nhập</th>
                                        <th scope="col">Điểm</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let s of subject.scores">
                                        <td>{{ s.type }}</td>
                                        <td>{{ s.date }}</td>
                                        <td>{{ s.score }}</td>
                                    </tr>
                                    <tr *ngIf="subject.attendanceSummary" class="table-secondary">
                                        <td colspan="2">
                                            <strong>{{ subject.attendanceSummary.label }}</strong>
                                            <small class="text-muted">({{ subject.attendanceSummary.count }}
                                                lần)</small>
                                        </td>
                                        <td>
                                            <strong>{{ subject.attendanceSummary.average }}</strong>
                                        </td>
                                    </tr>

                                </tbody>
                            </table>

                            <div class="text-end mt-2 text-muted">
                                  <div>  <strong>Tình trạng môn học:</strong> {{ getSubjectStatus(subject.subjectCode) }}</div>
                                <strong>Điểm trung bình môn:</strong> {{ subject.average | number:'1.2-2' }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div *ngIf="subjectGroups.length === 0" class="alert alert-info mt-3">
                Không có dữ liệu điểm để hiển thị.
            </div>


            <!-- GPA & CLASSIFICATION -->
            <div *ngIf="subjectGroups.length > 0" class="alert alert-primary mt-4 text-end">
                <strong>GPA:</strong> {{ overallGPA }} <br />
                <strong>Xếp loại học lực:</strong> {{ academicClassification }}
            </div>

        </div>
    </div>
</div>